"use strict";(self.webpackChunkactivejdocs=self.webpackChunkactivejdocs||[]).push([[2180],{8059:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>d,toc:()=>h});var r=a(5893),i=a(1151),s=a(7618),t=a(3149);const o={sidebar_label:"Transforming bindings"},c="Binding transformations",d={id:"inject/binding-transformation",title:"Binding transformations",description:"In this tutorial, we will transform bindings declared in a separate standalone module. We will intercept a dependency exported in another module and",source:"@site/docs/inject/binding-transformation.mdx",sourceDirName:"inject",slug:"/inject/binding-transformation",permalink:"/inject/binding-transformation",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{sidebar_label:"Transforming bindings"},sidebar:"docs",previous:{title:"Generating bindings",permalink:"/inject/binding-generation"},next:{title:"Optional dependencies",permalink:"/inject/optional-dependencies"}},l={},h=[{value:"Example Launcher",id:"example-launcher",level:2},{value:"Person module",id:"person-module",level:2},{value:"Person transformation module",id:"person-transformation-module",level:2},{value:"Launching the example",id:"launching-the-example",level:2}];function m(e){const n={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"binding-transformations",children:"Binding transformations"}),"\n",(0,r.jsx)(n.p,{children:"In this tutorial, we will transform bindings declared in a separate standalone module. We will intercept a dependency exported in another module and\ntransform it so that it adds some basic logging before method execution and after method finishes."}),"\n",(0,r.jsx)(n.h2,{id:"example-launcher",children:"Example Launcher"}),"\n",(0,r.jsxs)(n.p,{children:["First, we will create a new Launcher by extending the ",(0,r.jsx)(s.Z,{url:"/launcher/src/main/java/io/activej/launcher/Launcher.java",children:(0,r.jsx)(n.code,{children:"Launcher"})})," class."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public class BindingTransformationExample extends Launcher {\n    ...\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then let's define the ",(0,r.jsx)(n.code,{children:"Person"})," interface with a single method ",(0,r.jsx)(n.code,{children:"void greet()"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:"url=/examples/core/inject-2/src/main/java/BindingTransformationExample.java tag=REGION_5",children:"public interface Person {\n  void greet();\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["And inject an instance of a ",(0,r.jsx)(n.code,{children:"Person"})," class into the application launcher by adding a ",(0,r.jsx)(n.code,{children:"person"})," field annotated with the ",(0,r.jsx)(n.code,{children:"@Inject"})," annotation."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:"url=/examples/core/inject-2/src/main/java/BindingTransformationExample.java tag=REGION_1",children:"@Inject\nPerson person;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Our application launcher overrides ",(0,r.jsx)(n.code,{children:"Launcher#run"})," method just to call ",(0,r.jsx)(n.code,{children:"person.greet()"})," method."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:"url=/examples/core/inject-2/src/main/java/BindingTransformationExample.java tag=REGION_3",children:"@Override\nprotected void run() {\n  person.greet();\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"person-module",children:"Person module"}),"\n",(0,r.jsxs)(n.p,{children:["An application launcher would use 2 modules to inject a ",(0,r.jsx)(n.code,{children:"Person person"})," dependency."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:"url=/examples/core/inject-2/src/main/java/BindingTransformationExample.java tag=REGION_2",children:"@Override\nprotected Module getModule() {\n  return Modules.combine(\n    new PersonModule(),\n    new PersonTransformModule()\n  );\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The first one (",(0,r.jsx)(n.code,{children:"PersonModule"}),") is a simple ",(0,r.jsx)(n.code,{children:"AbstractModule"})," that provides a single dependency for a ",(0,r.jsx)(n.code,{children:"Person"})," class."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:"url=/examples/core/inject-2/src/main/java/BindingTransformationExample.java tag=REGION_6",children:'public static class PersonModule extends AbstractModule {\n  @Provides\n  Person greeter() {\n    return () -> System.out.println("Hello!");\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["A provided ",(0,r.jsx)(n.code,{children:"Person"})," simply prints ",(0,r.jsx)(n.code,{children:'"Hello!"'})," when ",(0,r.jsx)(n.code,{children:"greet()"})," method is called."]}),"\n",(0,r.jsx)(n.h2,{id:"person-transformation-module",children:"Person transformation module"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"PersonTransformModule"})," is a module that intercepts the provided ",(0,r.jsx)(n.code,{children:"Person"})," class and adds logging to the ",(0,r.jsx)(n.code,{children:"greet()"})," method calls."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:"url=/examples/core/inject-2/src/main/java/BindingTransformationExample.java tag=REGION_7",children:'public static class PersonTransformModule extends AbstractModule {\n  @Override\n  protected void configure() {\n    transform(Person.class, (bindings, scope, key, binding) ->\n      binding.mapInstance(person ->\n        () -> {\n          System.out.println("Start of greeting");\n          person.greet();\n          System.out.println("End of greeting");\n        }\n      ));\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The module does not export any dependency using the ",(0,r.jsx)(n.code,{children:"@Provides"})," annotation. Instead it overrides ",(0,r.jsx)(n.code,{children:"AbstractModule#configure"})," method only to call the ",(0,r.jsx)(n.code,{children:"transform(...)"})," method.\nLet's take a closer look at the ",(0,r.jsx)(n.code,{children:"transform(...)"})," call. It takes 2 arguments:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Class"})," - the class of a binding to be transformed (it can be changed to a ",(0,r.jsx)(s.Z,{url:"/core-inject/src/main/java/io/activej/inject/KeyPattern.java",children:(0,r.jsx)(n.code,{children:"KeyPattern"})}),"\nto transform all bindings matched by a key pattern)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"BindingTransformer<T>"})," - a transformer which is itself a functional interfaces that accepts bindings, scope, current key and binding\nand returns a new binding (or the same binding if no transformation occurred)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["We call ",(0,r.jsx)(n.code,{children:"Binding#mapInstance"})," method on the received binding and specify how the ",(0,r.jsx)(n.code,{children:"Person"})," instance should be transformed.\nHere we return a new instance of the ",(0,r.jsx)(n.code,{children:"Person"})," class, which adds some ",(0,r.jsx)(n.code,{children:"System.out"})," logs before and after calling ",(0,r.jsx)(n.code,{children:"person.greet()"})," on an original person instance."]}),"\n",(0,r.jsx)(n.h2,{id:"launching-the-example",children:"Launching the example"}),"\n",(0,r.jsxs)(n.p,{children:["To launch the example, we need to define the ",(0,r.jsx)(n.code,{children:"main"})," method that simply creates a new instance of our application launcher and passes the application arguments to the ",(0,r.jsx)(n.code,{children:"Launcher#launch"})," method."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:"url=/examples/core/inject-2/src/main/java/BindingTransformationExample.java tag=REGION_4",children:"public static void main(String[] args) throws Exception {\n  BindingTransformationExample launcher = new BindingTransformationExample();\n  launcher.launch(args);\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["When launching the application it should print to ",(0,r.jsx)(n.code,{children:"stdout"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"Start of greeting\nHello!\nEnd of greeting\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can find example sources on ",(0,r.jsx)(t.Z,{href:"https://github.com/activej/activej/{{githubExamplesBranch}}/examples/core/inject-2/src/main/java/BindingTransformationExample.java",children:"Github"})]})]})}function p(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}},3149:(e,n,a)=>{a.d(n,{Z:()=>d});a(7294);var r=a(9962),i=a(1106),s=a.n(i),t=a(5835),o=a.n(t),c=a(5893);o().interpolate=/{{([\s\S]+?)}}/g;const d=function(e){let{href:n,children:a,target:i="_blank"}=e;const{siteConfig:t}=(0,r.Z)(),o=s()(n);return(0,c.jsx)("a",{href:o(t.customFields),target:i,children:a})}},7618:(e,n,a)=>{a.d(n,{Z:()=>s});a(7294);var r=a(9962),i=a(5893);const s=e=>{let{url:n,text:a,isInline:s=!0,children:t}=e;const{siteConfig:o}=(0,r.Z)(),c=n.startsWith("/examples")?o.customFields.githubExamplesBranch:o.customFields.githubBranch;return(0,i.jsx)("a",{style:s?{}:{display:"block",marginBottom:"16px"},href:o.customFields.githubUrl+"/"+c+n,target:"_blank",children:a||t})}}}]);